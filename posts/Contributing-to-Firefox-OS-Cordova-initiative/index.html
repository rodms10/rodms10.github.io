<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><title>Contributing to FirefoxOS Cordova initiative</title><meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Rodrigo Silveira" name="author"/><meta content="After the project I was working on got cancelled, I started contributing to Firefox OS Cordova project. Cordova is an open source framework for writing multi-platform native mobile applications using web technology. Cordova provides you with javascript APIs and the plumbing necessary to access the device's internals, such as ..." name="description"/><meta content="Contributing to FirefoxOS Cordova initiative" property="og:title"/><meta content="blog.post" property="og:type"/><meta content="http://blog.rodms.com/posts/Contributing-to-Firefox-OS-Cordova-initiative/" property="og:url"/><meta content="http://blog.rodms.com/theme/img/avatar.jpeg" property="og:image"/><meta content="After the project I was working on got cancelled, I started contributing to Firefox OS Cordova project. Cordova is an open source framework for writing multi-platform native mobile applications using web technology. Cordova provides you with javascript APIs and the plumbing necessary to access the device's internals, such as ..." property="og:description"/><link href="http://blog.rodms.com/theme/css/style.2b02ea6c.min.css" rel="stylesheet"/><link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet"/><link href="http://blog.rodms.com/theme/css/pygments.css" rel="stylesheet"/><!--[if lt IE 9]><script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--><link href="http://blog.rodms.com/favicon.ico" rel="shortcut icon"/><link href="http://blog.rodms.com/theme/img/apple-touch-icon.png" rel="apple-touch-icon"/><link href="http://blog.rodms.com/theme/img/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72"/><link href="http://blog.rodms.com/theme/img/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114"/><link href="http://blog.rodms.com/" rel="alternate" title="Rodrigo Silveira ATOM Feed" type="application/atom+xml"/></head><body class=""><header id="article-head"><div class="vertical"><div class="inner"><a href="http://blog.rodms.com" id="blog-logo"><img alt="Blog Logo" src="http://blog.rodms.com/theme/img/avatar.jpeg"/></a><h2 class="blog-title">Rodrigo Silveira</h2><h3 class="blog-description">Digressions on life, web and stuff.</h3></div></div></header><nav class="navbar"><ul class="navlist"><li><a href="http://blog.rodms.com/about/">About</a></li><li class="divider-vertical"></li><li><div id="tag-menu"><ul class="taglist"><li><a href="http://blog.rodms.com/tag/blog/"><i class="icon-tag"></i>blog</a></li><li><a href="http://blog.rodms.com/tag/bugzillator/"><i class="icon-tag"></i>bugzillator</a></li><li><a href="http://blog.rodms.com/tag/cordova/"><i class="icon-tag"></i>cordova</a></li><li><a href="http://blog.rodms.com/tag/pelican/"><i class="icon-tag"></i>pelican</a></li><li><a href="http://blog.rodms.com/tag/planet/"><i class="icon-tag"></i>planet</a></li></ul></div><a href="http://blog.rodms.com/tags/" id="nav-tags"><i class="icon-tag"></i>Tags</a></li><li class="divider-vertical"></li><li><a href="http://blog.rodms.com/archives/"><i class="icon-th-list"></i>Archives</a></li></ul></nav><main class="main-content" role="main"><div class="content"><div class="articles"><section id="content"><article class="post"><header><h1 class="post-title"><a href="" rel="bookmark" title="Permalink to Contributing to FirefoxOS Cordova initiative">Contributing to FirefoxOS Cordova initiative</a></h1></header><div class="post-meta"><footer class="post-info"><span class="label">Date:</span> <abbr class="published" title="2014-04-15T00:00:00"><i class="icon-calendar"></i>15 Apr 2014</abbr> <span class="label">Tags:</span> <a href="http://blog.rodms.com/tag/cordova/"><i class="icon-tag"></i>cordova</a> <a href="http://blog.rodms.com/tag/planet/"><i class="icon-tag"></i>planet</a></footer></div><section class="post-content"><p>After the project I was working on <a href="https://blog.mozilla.org/futurereleases/2014/03/14/metro/">got cancelled</a>, I started contributing to <a href="https://wiki.mozilla.org/CordovaFirefoxOS">Firefox OS Cordova project</a>. <a href="http://cordova.apache.org/">Cordova</a> is an open source framework for writing multi-platform native mobile applications using web technology. Cordova provides you with javascript APIs and the plumbing necessary to access the device's internals, such as battery status, GPS and camera. Neat stuff. Each mobile operating system has its own platform implementation for doing the communication between cordova's javascript API and the native OS code.</p><p>This post will focus on how to get started writing the Firefox OS platform and plugins. To get a better understanding on how to use cordova to write a Firefox OS app, I highly recommend the <a href="https://hacks.mozilla.org/2014/02/building-cordova-apps-for-firefox-os/">mozilla hacks post</a> on the subject.</p><p>Cordova is written in <a href="http://nodejs.org/">node.js</a>, you just need to understand javascript to work on it. It took me much code digging and asking around to get started, but you won't have to!</p><h2>The repositories</h2><p>Cordova code is organized into multiple repositories. The main ones you need to be aware of for Firefox OS development are <code>cordova-cli</code>, <code>cordova-firefoxos</code> and <code>cordova-plugin-*</code>. Here is a brief description of them:</p><ul><li><code>cordova-cli</code> - is where the code for the command line tools is located. There is some platform specific code under <code>src/metadata</code> which are config parsers. Firefox OS uses it to get the initial version of the manifest with the correct app name and other values.</li><li><code>cordova-firefoxos</code> - is the repository for the Firefox OS platform tools. The code here is responsible for handling Firefox OS cordova commands and for the initial skeletal app.</li><li><code>cordova-plugin-*</code> - are repositories for plugins. A plugin repository contains code for each supported platform too.</li></ul><h2>Running it locally</h2><p>To work on the platform, you need to run on the latest code from the repositories. It's super helpful to run cordova entirely from local files so that you can edit code and see the effects. With the multiple repository organization used by cordova, this can be tricky. Make sure you have <a href="http://git-scm.com/downloads">git</a> and <a href="http://nodejs.org/download/">node.js</a> installed. A <a href="https://github.com/">github</a> account will be handy if you plan to send us your changes. The prompt samples below are using bash.</p><p>First lets get <code>cordova-cli</code> from mozilla-cordova github account and install the dependencies. From the directory you'd like to keep cordova code run:</p><div class="codehilite"><pre><span class="nv">$ </span>git clone https://github.com/mozilla-cordova/cordova-cli.git
<span class="nv">$ </span><span class="nb">cd </span>cordova-cli
<span class="nv">$ </span>npm install
<span class="nv">$ </span><span class="nb">cd</span> ..
</pre></div><p>The cordova binary is located at <code>cordova-cli/bin/cordova</code>. From now on this is the binary we'll use for all our cordova command line needs. You can add it to your <code>PATH</code> if you want, I'll use the relative path for clarity. Next let's clone Firefox OS platform bits from <code>cordova-firefoxos</code> repository:</p><div class="codehilite"><pre><span class="nv">$ </span>git clone https://github.com/mozilla-cordova/cordova-firefoxos.git
</pre></div><p>No need to install dependencies for <code>cordova-firefoxos</code>, they're already part of the repository. Before creating an app, there's a little trick to tell cordova to use the local platform code we just downloaded. Create a file named <code>firefoxos.json</code> with the following contents:</p><div class="codehilite"><pre><span class="p">{</span>
    <span class="nt">"lib"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"firefoxos"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"uri"</span><span class="p">:</span> <span class="s2">"/&lt;FULL PATH TO&gt;/cordova-firefoxos"</span><span class="p">,</span>
            <span class="nt">"version"</span><span class="p">:</span> <span class="s2">"dev"</span><span class="p">,</span>
            <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"cordova-firefoxos-dev"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div><p>Make sure to set the full path to <code>cordova-firefoxos</code> folder under <code>uri</code>. We can now create a new cordova app by running <code>create</code>. Let's create the app in <code>myapp</code> folder and give it the even more original project name of <code>io.myapp</code> and name it <code>myapp</code>. The fourth parameter to <code>create</code> is the json config file we just create as a string. To create the app run:</p><div class="codehilite"><pre><span class="nv">$ </span>cordova-cli/bin/cordova create myapp io.myapp myapp <span class="s2">"$(cat firefoxos.json)"</span>
<span class="nv">$ </span><span class="nb">cd </span>myapp
</pre></div><p>Alternatively, to use a local copy of <code>cordova-firefoxos</code> platform code on a cordova app that already exists, you can create a json file with the same content as above under <code>yourapp/.cordova/config.json</code>. In fact, that fourth parameter created that file for you. Go check.</p><p>To add the platform, all you need to run is:</p><div class="codehilite"><pre><span class="nv">$ </span>../cordova-cli/bin/cordova platform add firefoxos
</pre></div><p>That's it. If you make any changes to <code>cordova-firefoxos</code>, remove and add the platform again to make sure you have the latest.</p><h2>Adding a plugin</h2><p>Working with local plugins is much simpler. Lets download the contacts plugin as an exemple:</p><div class="codehilite"><pre><span class="nv">$ </span><span class="nb">cd</span> ..
<span class="nv">$ </span>git clone https://github.com/mozilla-cordova/cordova-plugin-contacts.git
</pre></div><p>Adding a local version is pretty simple, just add the path as parameter to <code>plugin add</code> command:</p><div class="codehilite"><pre><span class="nv">$ </span><span class="nb">cd </span>myapp
<span class="nv">$ </span>../cordova-cli/bin/cordova plugin add ../cordova-plugin-contacts
</pre></div><p><em>NOTE: if at this point you hit a <code>ReferenceError: xml_helpers is not defined</code> error, don't despair. <a href="https://issues.apache.org/jira/browse/CB-6200">It's a bug</a> in <code>cordova-plugman</code> code, which is responsible for plugin management. We can fix it by getting the latest version of <code>cordova-plugman</code>, and making sure cordova-cli uses it too. Here's how:</em></p><div class="codehilite"><pre><span class="nv">$ </span><span class="nb">cd</span> ..
<span class="nv">$ </span>git clone https://github.com/apache/cordova-plugman.git
<span class="nv">$ </span><span class="nb">cd </span>cordova-cli
<span class="nv">$ </span>npm install ../cordova-plugman
<span class="nv">$ </span><span class="nb">cd</span> ../myapp
<span class="nv">$ </span>../cordova-cli/bin/cordova plugin add ../cordova-plugin-contacts
</pre></div><p>To see changes you made to plugin code you have to remove then add the plugin again. To remove the plugin you need to use the plugin name, not the path. Running <code>../cordova-cli/bin/cordova plugin ls</code> will show you the names of installed plugins. For example, to remove the contacts plugin run <code>../cordova-cli/bin/cordova plugin remove org.apache.cordova.contacts</code>.</p><p>That's it, you are now running the latest and greatest versions of it all!</p><h2>Firefox OS plugin development: from javascript to javascript</h2><p>Cordova provides you with a javascript API. They try to follow standards when possible. Firefox OS is built on web standards too. Sometimes they use the same API. How can a plugin developer access Firefox OS API when they clash?</p><p>Cordova provides us with a <code>modulemapper</code> library to access the original values of overwritten properties. Let's take a look at how the <a href="https://github.com/mozilla-cordova/cordova-plugin-battery-status/blob/dev/src/firefoxos/BatteryProxy.js#L22">battery-status plugin uses <code>modulemapper</code></a>:</p><div class="codehilite"><pre><span class="kd">var</span> <span class="nx">mozBattery</span> <span class="o">=</span> <span class="nx">cordova</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">'cordova/modulemapper'</span><span class="p">).</span><span class="nx">getOriginalSymbol</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">'navigator.battery'</span><span class="p">);</span>
</pre></div><p>The variable <code>mozBattery</code> now points to the original <code>navigator.battery</code>. The first parameter to <code>getOriginalSymbol</code> is the context, pretty much always <code>window</code>. The second is the value you want to get. To find out what value to use on the second parameter, check the <code>&lt;js-module&gt;</code> element in the plugin's <code>plugin.xml</code> configuration file. For the <a href="https://github.com/mozilla-cordova/cordova-plugin-battery-status/blob/dev/plugin.xml#L14-L16">battery-status plugin it is</a>:</p><div class="codehilite"><pre><span class="nt">&lt;js-module</span> <span class="na">src=</span><span class="s">"www/battery.js"</span> <span class="na">name=</span><span class="s">"battery"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;clobbers</span> <span class="na">target=</span><span class="s">"navigator.battery"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/js-module&gt;</span>
</pre></div><p>The <code>&lt;clobbers&gt;</code> element's <code>target</code> attribute has the value that was overwritten.</p><h2>Contributing</h2><p>If you got this far, you're ready to get started! Open up your favorite editor and hack on. If you want to help with Firefox OS support, check out <a href="http://mozilla-cordova.github.io/">our status site</a> and <a href="https://wiki.mozilla.org/CordovaFirefoxOS">the project's wiki</a>.</p><p>While writing this post I got news that I'm joining the team. Super excited to improve cordova support for Firefox OS! If you want to chat with us, we hang out on #cordova channel on <a href="https://wiki.mozilla.org/IRC">mozilla's irc server</a>.</p></section><section class="post-footer share"><h4>Share this post:</h4><a class="icon-twitter" href="http://twitter.com/share?text=Contributing%20to%20FirefoxOS%20Cordova%20initiative%20via%20@rodms10" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><span class="hidden">Twitter</span></a> <a class="icon-facebook-sign" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.rodms.com/posts/Contributing-to-Firefox-OS-Cordova-initiative/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"><span class="hidden">Facebook</span></a></section></article><div class="comments inner"><div id="disqus_thread"></div><script type="text/javascript">
      var disqus_identifier = "posts/Contributing-to-Firefox-OS-Cordova-initiative/";
      (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//rodms.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] ||
          document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script></div></section></div></div><footer class="site-footer"><div class="social-icons"><a href="http://twitter.com/rodms10" target="_blank" title="Follow"><i class="icon-twitter icon-2x"></i></a> <a href="https://github.com/rodms10" target="_blank" title="Fork"><i class="icon-github icon-2x"></i></a> <a href="http://www.linkedin.com/in/rodms10" target="_blank" title="Network"><i class="icon-linkedin icon-2x"></i></a> <a href="http://blog.rodms.com/feed.xml" rel="alternate" target="_blank" title="Subscribe"><i class="icon-rss icon-2x"></i></a></div><address id="about">Powered by <a href="http://pelican.notmyidea.org/">Pelican <i class="icon-external-link"></i></a> a static site generator, written in <a href="http://python.org">Python <i class="icon-external-link"></i></a>.</address></footer></main><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script src="http://blog.rodms.com/theme/js/pack.min.js?47aa4328"></script><script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-45383543-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script></body></html>